"use strict";(()=>{var e={};e.id=215,e.ids=[215],e.modules={3524:e=>{e.exports=require("@prisma/client")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{e.exports=require("assert")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},7702:e=>{e.exports=require("events")},2048:e=>{e.exports=require("fs")},629:e=>{e.exports=require("fs/promises")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},5807:e=>{e.exports=require("module")},9801:e=>{e.exports=require("os")},5315:e=>{e.exports=require("path")},8621:e=>{e.exports=require("punycode")},8220:e=>{e.exports=require("stream")},4175:e=>{e.exports=require("tty")},7360:e=>{e.exports=require("url")},1764:e=>{e.exports=require("util")},6162:e=>{e.exports=require("worker_threads")},1568:e=>{e.exports=require("zlib")},778:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>y,patchFetch:()=>f,requestAsyncStorage:()=>q,routeModule:()=>g,serverHooks:()=>x,staticGenerationAsyncStorage:()=>b});var o={};t.r(o),t.d(o,{POST:()=>k,runtime:()=>_});var a=t(261),s=t(8331),i=t(4510),u=t(9784),n=t(2942),p=t(8361),l=t(7151),c=t(3196),d=t(4051);let _="nodejs",m=e=>{for(let r of["message","edited_message","callback_query","inline_query","chosen_inline_result","channel_post","edited_channel_post","chat_member","my_chat_member","chat_join_request","shipping_query","pre_checkout_query","poll","poll_answer"])if(r in e)return r},h=e=>{let r=m(e),t=e.message??e.edited_message??e.channel_post??e.edited_channel_post??e.callback_query?.message??e.chat_join_request??e.chat_member??e.my_chat_member,o=e.message?.from??e.edited_message?.from??e.callback_query?.from??e.inline_query?.from??e.chosen_inline_result?.from??e.chat_join_request?.from??e.chat_member?.from??e.my_chat_member?.from??e.shipping_query?.from??e.pre_checkout_query?.from??e.poll_answer?.user,a=t?.chat?.id??e.callback_query?.message?.chat?.id??e.chat_join_request?.chat?.id,s=o?.id,i=t?.message_id??e.callback_query?.message?.message_id,u=e.callback_query?.data;return{updateType:r,updateId:"number"==typeof e.update_id?e.update_id:void 0,chatId:a,fromId:s,messageId:i,meta:{topKeys:Object.keys(e),messageKeys:t?Object.keys(t):null,hasPhoto:!!t?.photo?.length,hasText:!!t?.text,hasCaption:!!t?.caption,mediaGroupId:t?.media_group_id?String(t.media_group_id):void 0,callbackDataPrefix:"string"==typeof u?u.slice(0,20):void 0}}};async function k(e,{params:r}){let t;if(r.secret!==n.O.webhookSecret)return u.NextResponse.json({ok:!1},{status:404});if(n.O.telegramWebhookSecretToken&&e.headers.get("x-telegram-bot-api-secret-token")!==n.O.telegramWebhookSecretToken)return u.NextResponse.json({ok:!1},{status:401});let o=e.headers.get("content-type"),a="";try{a=await e.text(),t=JSON.parse(a)}catch(e){try{await (0,d.K)(l._,{level:"error",kind:"webhook_parse_error",meta:{rawLen:a.length,contentType:o},err:e})}catch(e){p.k.error({err:e},"Failed to log webhook parse error")}return u.NextResponse.json({ok:!0})}let s="number"==typeof t.update_id?t.update_id:null;if(!s)return await (0,d.K)(l._,{level:"error",kind:"webhook_missing_update_id",meta:{topKeys:Object.keys(t)},err:Error("Missing update_id")}),u.NextResponse.json({ok:!0});try{await l._.telegramUpdateQueue.upsert({where:{updateId:s},update:{},create:{updateId:s,payload:t}})}catch(e){try{let r=h(t);await (0,d.K)(l._,{level:"error",kind:"webhook_queue_error",...r,err:e})}catch(e){p.k.error({err:e},"Failed to log webhook queue error")}}try{let e=await (0,c.M)();await e.bot.handleUpdate(t)}catch(e){try{let r=h(t);await (0,d.K)(l._,{level:"error",kind:"webhook_handle_error",...r,err:e})}catch(e){p.k.error({err:e},"Failed to log webhook handle error")}}return u.NextResponse.json({ok:!0})}let g=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/telegram/webhook/[secret]/route",pathname:"/api/telegram/webhook/[secret]",filename:"route",bundlePath:"app/api/telegram/webhook/[secret]/route"},resolvedPagePath:"/Users/ilias_iangurazov/Desktop/telegram-shift-bot/src/app/api/telegram/webhook/[secret]/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:q,staticGenerationAsyncStorage:b,serverHooks:x}=g,y="/api/telegram/webhook/[secret]/route";function f(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:b})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[937,830,157,196],()=>t(778));module.exports=o})();